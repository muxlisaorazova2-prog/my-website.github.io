<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laylaklarni Tanish AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --main-color: #38bdf8; --bg-dark: #0f172a; }
        body { font-family: sans-serif; background-color: #f0f4f8; margin: 0; padding: 20px; display: flex; justify-content: center; }
        
        /* Asosiy karta dizayni */
        .card { 
            background: white; padding: 30px; border-radius: 25px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            text-align: center; max-width: 400px; width: 100%;
        }
        
        h2 { color: #1e293b; margin-bottom: 20px; }
        
        /* Kamera turadigan joy */
        #webcam-container { 
            margin: 20px auto; width: 200px; height: 200px; 
            border: 4px solid var(--main-color); border-radius: 20px; 
            overflow: hidden; background: #000;
        }

        /* Natijalar chiqadigan joy */
        #label-container { margin-top: 20px; text-align: left; }
        .result-item { margin-bottom: 10px; }
        .bar-bg { background: #e2e8f0; height: 8px; border-radius: 4px; margin-top: 5px; }
        .bar-fill { background: var(--main-color); height: 100%; border-radius: 4px; transition: 0.3s; }

        /* Tugma dizayni */
        .start-btn { 
            background: var(--main-color); color: white; border: none; 
            padding: 12px 25px; border-radius: 12px; font-weight: bold; 
            cursor: pointer; font-size: 16px; transition: 0.3s;
        }
        .start-btn:hover { background: #0ea5e9; transform: scale(1.05); }
    </style>
</head>
<body>

<div class="card">
    <h2>ðŸ¦¢ Laylaklarni Tanish AI</h2>
    <p style="color: #64748b; font-size: 14px;">Kameraga laylak rasmini ko'rsating</p>
    
    <div id="webcam-container"></div>
    
    <button class="start-btn" type="button" onclick="init()">
        <i class="fas fa-camera"></i> Loyihani ishga tushirish
    </button>
    
    <div id="label-container"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

<script type="text/javascript">
    // Sizning modelingiz linki
    const URL = "https://teachablemachine.withgoogle.com/models/SHYWKBmfo/";

    let model, webcam, labelContainer, maxPredictions;

    async function init() {
        const startBtn = document.querySelector('.start-btn');
        startBtn.innerHTML = "Yuklanmoqda...";
        startBtn.disabled = true;

        try {
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            // Modelni yuklash
            model = await tmImage.load(modelURL, metadataURL);
            maxPredictions = model.getTotalClasses();

            // Kamerani sozlash
            const flip = true; 
            webcam = new tmImage.Webcam(200, 200, flip); 
            await webcam.setup(); 
            await webcam.play();
            window.requestAnimationFrame(loop);

            // Kamerani ekranda ko'rsatish
            document.getElementById("webcam-container").appendChild(webcam.canvas);
            
            labelContainer = document.getElementById("label-container");
            for (let i = 0; i < maxPredictions; i++) {
                labelContainer.appendChild(document.createElement("div"));
            }
            
            startBtn.style.display = "none"; // Ishga tushgach tugmani yashirish
        } catch (error) {
            console.error(error);
            alert("Kameraga ruxsat berilmadi yoki model yuklanmadi!");
            startBtn.innerHTML = "Qayta urinish";
            startBtn.disabled = false;
        }
    }

    async function loop() {
        webcam.update(); 
        await predict();
        window.requestAnimationFrame(loop);
    }async function predict() {
        const prediction = await model.predict(webcam.canvas);
        for (let i = 0; i < maxPredictions; i++) {
            const prob = (prediction[i].probability * 100).toFixed(0);
            const className = prediction[i].className;
            
            labelContainer.childNodes[i].innerHTML = 
                <div class="result-item">
                    <div style="display:flex; justify-content:space-between; font-size:13px; font-weight:bold; color:#1e293b;">
                        <span>${className}</span>
                        <span>${prob}%</span>
                    </div>
                    <div class="bar-bg">
                        <div class="bar-fill" style="width: ${prob}%"></div>
                    </div>
                </div>;
        }
    }
</script>

</body>
</html>
